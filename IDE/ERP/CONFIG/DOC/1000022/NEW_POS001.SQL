EXECUTE BLOCK RETURNS (
  J_ID       TYPE OF COLUMN TABL$J_4.ID,
  DOCTYPE_ID TYPE OF COLUMN TABL$J_4.TYPE_ID)
AS
  DECLARE VARIABLE P_FIRM_ID    TYPE OF COLUMN TABL$R_FIRMS.ID;
  DECLARE VARIABLE P_FILIAL_IDS TYPE OF COLUMN TABL$J_4.NAME;
  DECLARE VARIABLE P_FILIAL_ID  TYPE OF COLUMN TABL$J_4.FILIAL_ID;
  DECLARE VARIABLE P_CS_ID      TYPE OF COLUMN TABL$J_1000014.PLACE_ID;
  DECLARE VARIABLE P_PLACE_ID   TYPE OF COLUMN TABL$J_1000014.PLACE_ID;
  DECLARE VARIABLE P_TAX_ID     TYPE OF COLUMN TABL$J_1000014.TAX_ID;
  DECLARE VARIABLE P_WRK_ID     TYPE OF COLUMN TABL$J_1000014.WRK_ID;
  DECLARE VARIABLE P_NDP_PAY    TYPE OF COLUMN TABL$R_FIRMS.NDP_PAY;
BEGIN
  DOCTYPE_ID = 1000022;

  P_FIRM_ID = GEN_ID(GENR$R_FIRMS_DEFAULT, 0);
  IF(NOT(EXISTS(SELECT F1.ID FROM TABL$R_FIRMS F1 WHERE (F1.ID = :P_FIRM_ID))))THEN
    BEGIN
    SELECT MIN(F2.ID)
    FROM   TABL$R_FIRMS F2
    INTO   :P_FIRM_ID;
    END
  P_CS_ID   = GEN_ID(GENR$R_CS_DEFAULT_CUSTOMER, 0);

  P_TAX_ID = 1000008;
  SELECT FIRST 1 COALESCE(F.NDP_PAY, 0)
  FROM   TABL$R_FIRMS F
  WHERE  (F.ID = :P_FIRM_ID)
  INTO   :P_NDP_PAY; IF(:P_NDP_PAY = 1)THEN P_TAX_ID = 1000010;

  P_FILIAL_IDS = COALESCE( RDB$GET_CONTEXT('USER_SESSION', 'DATABASE_FILIAL'), '' );
  IF( (TRIM(:P_FILIAL_IDS) = '') OR (:P_FILIAL_IDS IS NULL) )THEN
    BEGIN
    SELECT FIRST 1 FL.ID FROM PROC$R_FILIALS_DEFAULT FL INTO :P_FILIAL_ID;
    END
   ELSE
    BEGIN
    P_FILIAL_ID = CAST(:P_FILIAL_IDS AS INTEGER);
    END

  P_PLACE_ID = 0;
  SELECT FIRST 1 COALESCE(MIN(PL.ID), 0)
  FROM   TABL$R_PLACES PL
  WHERE  (PL.FILIAL_ID = :P_FILIAL_ID)
    AND  (PL.ACC_ID    = 281)
  INTO   :P_PLACE_ID;

  IF(:P_PLACE_ID = 0)THEN
    BEGIN
    SELECT FIRST 1 COALESCE(MIN(PL.ID), 0)
    FROM   TABL$R_PLACES PL
    INTO   :P_PLACE_ID;
    END

  SELECT FIRST 1 COALESCE(W.ID,0)
  FROM   TABL$R_WRK W
  WHERE  (W.USER_NAME = RDB$GET_CONTEXT('USER_SESSION','DATABASE_USER'))
  INTO   :P_WRK_ID; IF(:P_WRK_ID IS NULL)THEN P_WRK_ID = 0;

  SELECT FIRST 1 P.J_ID FROM PROC$J_INS_4(:P_FIRM_ID, :DOCTYPE_ID, NULL) P INTO :J_ID;

  INSERT INTO TABL$J_1000014 (J_ID, CS_ID, CS_ADDR_ID, PLACE_ID, TAX_ID, TO_PLACE_ID, WRK_ID, TMC_GRID_ID)
    VALUES (:J_ID, :P_CS_ID, 0, :P_PLACE_ID, :P_TAX_ID, 0, :P_WRK_ID, 0);

  SUSPEND;
END
